#!/bin/sh

screenshot=/tmp/screenshot.png

if [ $# -gt 0 ]; then
    import -window $1 $screenshot
else
    # Left click to select area, right click for the entire selected window
    import $screenshot
fi

md5=`md5sum -b $screenshot | cut -d ' ' -f 1`
remote="aduros.emufarmers.com/dump/$md5.png"

# Upload
scp -B $screenshot "aduros@aduros.emufarmers.com:$remote"

# Copy the URL into the clipboard
echo -n "http://$remote" | xsel -i

# Show a notification
thumb=/tmp/screenshot_thumb.bmp # bitmap format required here
convert $screenshot $thumb
notify-send "Screenshot uploaded" "URL copied to X clipboard" -i $thumb

# Cleanup
rm -f $thumb
rm -f $screenshot
